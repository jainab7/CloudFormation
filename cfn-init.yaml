---
Parameters:
    SSHSecurityGroup:
       Type: AWS::EC2::SecurityGroup::Id
       Description: Security Group for SSH

Resources:
    MyInstance:
        Type: AWS::EC2::Instance
        Properties:
           ImageId: ami-009d6802948d06e52
           InstanceType: t2.micro
           SecurityGroupIds:
              - !Ref SSHSecurityGroup
           UserData:
             Fn::Base64: 
                !Sub |
                #!/bin/bash -xe
                # Get the latest CF package
                yum update -y aws-cfn-bootstrap
                # Start cfn-init
                /opt/aws/bin/cfn-init -s ${AWS::StackId} -r MyInstance --region ${AWS::Region} 
                # Start cfn-signal to wait condition
                /opt/aws/bin/cfn-signal -e $? --stack ${AWS::StackId} --resource SampleWaitCondition              


        Metadata:
          Comment: Install a simple Apache page
          AWS::CloudFormation::Init:
            config:
              packages:
                 yum:
                   httpd: []
              files:
                "/var/www/html/index.html":
                   content: |
                      <h1>Hello World from instance</h1>
                      <p>This was created using cfn-init</p>
                   mode: '000644'
              commands:
                hello:
                  command: "echo 'hello world'"
              services:
                sysvinit:
                  httpd:
                    enabled: 'true'
                    ensureRunning: 'true'
    
    SampleWaitCondition:
      CreationPolicy:
         ResourceSignal:
            Timeout: PT2M
            Count: 1
      Type: AWS::CloudFormation::WaitCondition


                   
               
